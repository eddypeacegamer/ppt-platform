<div class="row">
  <div class="col-md-12">
    <nb-card class="inline-form-card">
      <nb-card-header class="puff_center">Reportes</nb-card-header>
      <!--  PROMOTOR  -->
      <nb-card-body *ngIf="module === 'promotor'">

        <div class="row slide_1 my-1">
          <div class="col-4">
            <label for="inputFolio" class="label">Pre-folio</label>
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.prefolio"
              [disabled]="filterParams.emisor.length > 0 || filterParams.remitente.length > 0" id="inputFolio"
              placeholder="Folio PreCFDI">
          </div>

          <div class="col-4">
            <label for="inputTypoDoc" class="label">Tipo Documento</label>
            <select id="inputTypoDoc" style="display:block;" class="form-control"
              [(ngModel)]="filterParams.tipoDocumento" [disabled]="filterParams.prefolio.length > 0">
              <option value="*">Todos</option>
              <option value="Factura">Factura</option>
              <option value="Complemento">Complemento</option>
            </select>
          </div>

          <div class="col-4">
            <label for="inputStatus" class="label">Estatus factura</label>
            <select id="inputStatus" style="display:block;" class="form-control" [(ngModel)]="filterParams.status"
              [disabled]="filterParams.prefolio.length > 0">
              <option value="*">Todos</option>
              <option value="1">Validacion operaciones</option>
              <option value="2">Validacion tesoreria</option>
              <option value="4">Por Timbrar</option>
              <option value="3">Timbrada</option>
              <option value="5">Rechazo tesoreria</option>
              <option value="6">Rechazo Operaciones</option>
              <option value="7">Cancelada</option>
            </select>
          </div>

        </div>

        <div class="row slide_2 my-1">

          <div class="col-3">
            <label for="inputPayMethod" class="label">Metodo Pago</label>
            <select id="inputPayMethod" style="display:block;" class="form-control"
              [(ngModel)]="filterParams.metodoPago" [disabled]="filterParams.prefolio.length > 0">
              <option value="*">Todos</option>
              <option value="PUE">Pago Unica Exibición(PUE)</option>
              <option value="PPD">Pago en Parcialidades(PPD)</option>
            </select>
          </div>

          <div class="col-3">
            <label for="inputSaldo" class="label">Saldo pendiente</label>
            <select id="inputSaldo" style="display:block;" class="form-control"
              [(ngModel)]="filterParams.saldoPendiente" [disabled]="filterParams.prefolio.length > 0">
              <option value="0">Todas</option>
              <option value="10000"> Mas de $10000</option>
              <option value="50000">Mas de $50000</option>
              <option value="100000">Mas de $100000</option>
              <option value="250000">Mas de $250000</option>
              <option value="500000">Mas de $500000</option>
            </select>
          </div>

          <div class="col-3">
            <label for="inputTimbrado" class="label">Desde</label>
            <input nbInput placeholder="Desde" [nbDatepicker]="sincepicker" fullWidth style="display:block;"
              [disabled]="filterParams.prefolio.length > 0" [(ngModel)]="filterParams.since">
            <nb-datepicker #sincepicker></nb-datepicker>
          </div>

          <div class="col-3">
            <label for="inputTimbrado" class="label">Hasta</label>
            <input nbInput placeholder="Hasta" [nbDatepicker]="topicker" fullWidth style="display:block;"
              [disabled]="filterParams.prefolio.length > 0" [(ngModel)]="filterParams.to">
            <nb-datepicker #topicker></nb-datepicker>
          </div>
        </div>
        
        <div class="row slide_3 my-1">

          <div class="col-4">
            <label for="inputEmisor" class="label">Emisor</label>
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.emisor"
              [disabled]="filterParams.prefolio.length > 0" id="inputEmisor" placeholder="Razón Social Emisor">
          </div>

          <div class="col-4">
            <label for="InputReceptor" class="label">Receptor</label>
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.remitente"
              [disabled]="filterParams.prefolio.length > 0" id="InputReceptor" placeholder="Razón Social Receptor">
          </div>

          <div class="col-4">
            <button type="button" style="width: 100%; margin-top: 28px;" (click)="updateDataTable(0,10)" nbButton
              status="primary">BUSCAR</button>
          </div>
        </div>


      </nb-card-body>

      <!--  OPERACIONES  -->
      <nb-card-body *ngIf="module === 'operaciones' || module === 'administracion' ||  module === 'tesoreria' ">
        <div class="row slide_1 my-1">

          <div class="col-3">
            <label for="inputFolio" class="label">Pre-folio</label>
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.prefolio"
              [disabled]="filterParams.emisor.length > 0 || filterParams.remitente.length > 0" id="inputFolio"
              placeholder="Folio PreCFDI">
          </div>

          <div class="col-3">
            <label for="inputPromotor" class="label">Promotor</label>
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.solicitante" id="inputPromotor" [disabled]="filterParams.prefolio.length > 0"
              placeholder="Correo promotor">
          </div>

          <div class="col-3">
            <label for="inputTypoDoc" class="label">Tipo Documento</label>
            <select id="inputTypoDoc" style="display:block;" class="form-control"
              [(ngModel)]="filterParams.tipoDocumento" [disabled]="filterParams.prefolio.length > 0">
              <option value="*">Todos</option>
              <option value="Factura">Factura</option>
              <option value="Complemento">Complemento</option>
            </select>
          </div>

          <div class="col-3">
            <label for="inputStatus" class="label">Estatus factura</label>
            <select id="inputStatus" style="display:block;" class="form-control" [(ngModel)]="filterParams.status"
              [disabled]="filterParams.prefolio.length > 0">
              <option value="*">Todos</option>
              <option value="1">Validacion operaciones</option>
              <option value="2">Validacion tesoreria</option>
              <option value="4">Por Timbrar</option>
              <option value="3">Timbrada</option>
              <option value="5">Rechazo tesoreria</option>
              <option value="6">Rechazo Operaciones</option>
              <option value="7">Cancelada</option>
            </select>
          </div>

        </div>
      
        <div class="row slide_2 my-1">

          <div class="col-3">
            <label for="inputPayMethod" class="label">Metodo Pago</label>
            <select id="inputPayMethod" style="display:block;" class="form-control"
              [(ngModel)]="filterParams.metodoPago" [disabled]="filterParams.prefolio.length > 0">
              <option value="*">Todos</option>
              <option value="PUE">Pago Unica Exibición(PUE)</option>
              <option value="PPD">Pago en Parcialidades(PPD)</option>
            </select>
          </div>

          <div class="col-3">
            <label for="inputSaldo" class="label">Saldo pendiente</label>
            <select id="inputSaldo" style="display:block;" class="form-control"
              [(ngModel)]="filterParams.saldoPendiente" [disabled]="filterParams.prefolio.length > 0">
              <option value="0">Todas</option>
              <option value="10000"> Mas de $10000</option>
              <option value="50000">Mas de $50000</option>
              <option value="100000">Mas de $100000</option>
              <option value="250000">Mas de $250000</option>
              <option value="500000">Mas de $500000</option>
            </select>
          </div>

          <div class="col-3">
            <label for="inputTimbrado" class="label">Desde</label>
            <input nbInput placeholder="Desde" [nbDatepicker]="sincepicker" fullWidth style="display:block;"
              [disabled]="filterParams.prefolio.length > 0" [(ngModel)]="filterParams.since">
            <nb-datepicker #sincepicker></nb-datepicker>
          </div>

          <div class="col-3">
            <label for="inputTimbrado" class="label">Hasta</label>
            <input nbInput placeholder="Hasta" [nbDatepicker]="topicker" fullWidth style="display:block;"
              [disabled]="filterParams.prefolio.length > 0" [(ngModel)]="filterParams.to">
            <nb-datepicker #topicker></nb-datepicker>
          </div>
        </div>

        <div class="row slide_3 my-1">

          <div class="col-4">
            <label for="inputEmisor" class="label">Emisor</label>
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.emisor"
              [disabled]="filterParams.prefolio.length > 0" id="inputEmisor" placeholder="Razón Social Emisor">
          </div>

          <div class="col-4">
            <label for="InputReceptor" class="label">Receptor</label>
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.remitente"
              [disabled]="filterParams.prefolio.length > 0" id="InputReceptor" placeholder="Razón Social Receptor">
          </div>

          <div class="col-4">
            <button type="button" style="width: 100%; margin-top: 28px;" (click)="updateDataTable(0,10)" nbButton
              status="primary">BUSCAR</button>
          </div>
        </div>
      </nb-card-body>

      <!--  CONTABILIDAD  -->
      <nb-card-body *ngIf="module === 'contabilidad'">
        <div class="row slide_1 my-1">

          <div class="col-3">
            <label for="inputFolio" class="label">Pre-folio</label>
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.prefolio"
              [disabled]="filterParams.emisor.length > 0 || filterParams.remitente.length > 0" id="inputFolio"
              placeholder="Folio PreCFDI">
          </div>

          <div class="col-3">
            <label for="inputLinea" class="label">Línea Emisora</label>
            <select id="inputLinea" style="display:block;" class="form-control" [(ngModel)]="filterParams.lineaEmisor"
              [disabled]="filterParams.prefolio.length > 0">
              <option value="A">Línea A</option>
              <option value="B">Línea B</option>
              <option value="C">Línea C</option>
              <option value="D">Línea D</option>
            </select>
          </div>

          <div class="col-3">
            <label for="inputTypoDoc" class="label">Tipo Documento</label>
            <select id="inputTypoDoc" style="display:block;" class="form-control"
              [(ngModel)]="filterParams.tipoDocumento" [disabled]="filterParams.prefolio.length > 0">
              <option value="*">Todos</option>
              <option value="Factura">Factura</option>
              <option value="Complemento">Complemento</option>
            </select>
          </div>

          <div class="col-3">
            <label for="inputStatus" class="label">Estatus factura</label>
            <select id="inputStatus" style="display:block;" class="form-control" [(ngModel)]="filterParams.status"
              [disabled]="filterParams.prefolio.length > 0">
              <option value="8">Por timbrar</option>
              <option value="3">Timbrada</option>
              <option value="7">Cancelada</option>
              <option value="9">Rechazada contabilidad</option>
              <option value="5">Rechazada tesoreria</option>
              <option value="6">Rechazada operaciones</option>
            </select>
          </div>

        </div>

        <div class="row slide_2 my-1">

          <div class="col-3">
            <label for="inputPayMethod" class="label">Metodo Pago</label>
            <select id="inputPayMethod" style="display:block;" class="form-control"
              [(ngModel)]="filterParams.metodoPago" [disabled]="filterParams.prefolio.length > 0">
              <option value="*">Todos</option>
              <option value="PUE">Pago Unica Exibición(PUE)</option>
              <option value="PPD">Pago en Parcialidades(PPD)</option>
            </select>
          </div>

          <div class="col-3">
            <label for="inputSaldo" class="label">Saldo pendiente</label>
            <select id="inputSaldo" style="display:block;" class="form-control"
              [(ngModel)]="filterParams.saldoPendiente" [disabled]="filterParams.prefolio.length > 0">
              <option value="0">Todas</option>
              <option value="10000"> Mas de $10000</option>
              <option value="50000">Mas de $50000</option>
              <option value="100000">Mas de $100000</option>
              <option value="250000">Mas de $250000</option>
              <option value="500000">Mas de $500000</option>
            </select>
          </div>

          <div class="col-3">
            <label for="inputTimbrado" class="label">Desde</label>
            <input nbInput placeholder="Desde" [nbDatepicker]="sincepicker" fullWidth style="display:block;"
              [disabled]="filterParams.prefolio.length > 0" [(ngModel)]="filterParams.since">
            <nb-datepicker #sincepicker></nb-datepicker>
          </div>

          <div class="col-3">
            <label for="inputTimbrado" class="label">Hasta</label>
            <input nbInput placeholder="Hasta" [nbDatepicker]="topicker" fullWidth style="display:block;"
              [disabled]="filterParams.prefolio.length > 0" [(ngModel)]="filterParams.to">
            <nb-datepicker #topicker></nb-datepicker>
          </div>
        </div>

        <div class="row slide_3 my-1">

          <div class="col-4">
            <label for="inputEmisor" class="label">Emisor</label>
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.emisor"
              [disabled]="filterParams.prefolio.length > 0" id="inputEmisor" placeholder="Razón Social Emisor">
          </div>

          <div class="col-4">
            <label for="InputReceptor" class="label">Receptor</label>
            <input type="text" class="form-control" fullWidth [(ngModel)]="filterParams.remitente"
              [disabled]="filterParams.prefolio.length > 0" id="InputReceptor" placeholder="Razón Social Receptor">
          </div>

          <div class="col-4">
            <button type="button" style="width: 100%; margin-top: 28px;" (click)="updateDataTable(0,10)" nbButton
              status="primary">BUSCAR</button>
          </div>
        </div>
      </nb-card-body>



    </nb-card>
  </div>
</div>


<div class="row">
  <div class="col-md-12">
    <nb-card [nbSpinner]="loading" nbSpinnerStatus="info" nbSpinnerSize="giant">
      <nb-card-header class="puff_center">Facturas</nb-card-header>
      <nb-card-body>
        <div *ngIf="page.empty == true" class="alert alert-primary" role="alert">
          No se encontraron resultados
        </div>
        <div class="clearfix puff_center" *ngIf="page.empty == false">
          Resultados
          <div class="row float-right" style="margin-right: 1px;">

            <select id="inputunidad" style="display:block;width: 95px; margin-right: 15px;"
              class="float-right form-control" [(ngModel)]="filterParams.size"
              *ngIf="page.last==false || page.first==true" (change)="onChangePageSize($event.target.value)">
              <option value="10">10</option>
              <option *ngIf="page.number<(page.totalElements/20)" value="20">20</option>
              <option *ngIf="page.number<(page.totalElements/50)" value="50">50</option>
            </select>

            <button style="margin-right: 15px;" type="button" *ngIf="module === 'promotor'" (click)="downloadHandler()"
              class="btn btn-success float-right"><i class="fa fa-download"></i></button>
            <button style="margin-right: 15px;" type="button" *ngIf="module !== 'promotor'"
              (click)="downloadInvoicesReports()" class="btn btn-success float-right"><i
                class="fa fa-download"></i>Facturas</button>
            <button type="button" *ngIf="module !== 'promotor'" (click)="downloadComplementReports()"
              class="btn  btn-success float-right"><i class="fa fa-download"></i>Complementos</button>
          </div>

        </div>
        <div class="table-responsive slide_1" *ngIf="page.empty == false">

          <table class="table table-sm">
            <thead class="thead-dark">
              <tr>
                <th class="text-center" style="width: 190px;">Acciones</th>
                <th class="text-center">Pre-Folio</th>
                <th class="text-center">Folio</th>
                <th class="text-center">Razón Social Empresa</th>
                <th class="text-center">Razón Social Cliente</th>
                <th class="text-center">Tipo Documento</th>
                <th class="text-center">Método Pago</th>
                <th class="text-center">Estatus factura</th>
                <th class="text-center">Total</th>
                <th class="text-center">Saldo</th>
                <th class="text-center">Promotor</th>
                <th class="text-center">Observaciones</th>
                <th class="text-center">Solicitud</th>
                <th class="text-center">Actualización</th>
              </tr>
            </thead>
            <tbody>

              <tr *ngFor="let fila of page.content">

                <td scope="row" class="text-center" style="min-width: 180px;">
                  <button type="button" class="btn btn-sm btn-outline-primary" (click)="redirectToCfdi(fila.idCfdi)"><i
                      class="fa fa-search"></i>
                  </button>
                  <button type="button" class="btn btn-sm btn-outline-primary" *ngIf="module === 'promotor'"
                    [ngClass]="{'btn-outline-secondary': (fila.tipoDocumento === 'Factura' && fila.metodoPago === 'PPD') || (fila.statusFactura !== 'Validacion operaciones' && fila.statusFactura !== 'Validacion tesoreria' ), 'btn-outline-primary':(fila.tipoDocumento == 'Complemento' || fila.metodoPago == 'PUE') && (fila.statusFactura === 'Validacion operaciones' || fila.statusFactura === 'Validacion tesoreria') }"
                    [disabled]="(fila.tipoDocumento === 'Factura' && fila.metodoPago === 'PPD') || (fila.statusFactura !== 'Validacion operaciones' && fila.statusFactura !== 'Validacion tesoreria' )"
                    (click)="redirectToPreferences(fila.folio)"><i class="fa fa-wallet"></i>
                  </button>
                  <button type="button" class="btn btn-sm btn-outline-primary"
                    *ngIf="module !== 'promotor' && module !== 'contabilidad'"
                    [ngClass]="{'btn-outline-secondary': (fila.tipoDocumento === 'Factura' && fila.metodoPago === 'PPD'), 'btn-outline-primary':(fila.tipoDocumento == 'Complemento' || fila.metodoPago == 'PUE') }"
                    [disabled]=" (fila.tipoDocumento === 'Factura' && fila.metodoPago === 'PPD')"
                    (click)="redirectToDevolutionDetails(fila.folio)"><i class="fa fa-university"></i>
                  </button>
                  <button type="button" class="btn btn-sm btn-outline-primary"
                    (click)="downloadPdf(fila.rfcEmisor,fila.rfcRemitente,fila.folio)">
                    <i class="fa fa-file-pdf"></i>
                  </button>
                  <button type="button" class="btn btn-sm btn-outline-primary"
                    [disabled]="fila.statusFactura !== 'Timbrada'"
                    [ngClass]="{'btn-outline-secondary': fila.statusFactura !== 'Timbrada' , 'btn-outline-primary':fila.statusFactura === 'Timbrada'}"
                    (click)="downloadXml(fila.rfcEmisor,fila.rfcRemitente,fila.folio)">
                    <i class="fa fa-code"></i>
                  </button>
                  <button type="button" class="btn btn-sm btn-outline-primary"
                    [disabled]="(fila.statusFactura !== 'Timbrada')" *ngIf=" fila.lineaEmisor ==='A'"
                    [ngClass]="{'btn-outline-secondary': fila.statusFactura !== 'Timbrada'  , 'btn-outline-primary':fila.statusFactura === 'Timbrada'}"
                    (click)="reSendEmail(fila.folio)">
                    <i class="fa fa-reply-all"></i>
                  </button>
                </td>

                <td scope="row">{{fila.preFolio}}</td>
                <td scope="row">{{fila.folio}}</td>
                <td scope="row">{{fila.razonSocialEmisor}}</td>
                <td scope="row">{{fila.razonSocialRemitente}}</td>
                <td scope="row">{{fila.tipoDocumento}}</td>
                <td scope="row">{{fila.metodoPago}}</td>
                <td scope="row">{{fila.statusFactura}}</td>
                <td scope="row">{{fila.total | currency}}</td>
                <td scope="row">{{fila.saldoPendiente | currency}}</td>
                <td scope="row">{{fila.solicitante}}</td>
                <td scope="row">{{fila.statusDetail}}</td>
                <td scope="row">{{fila.fechaCreacion}}</td>
                <td scope="row">{{fila.fechaActualizacion}}</td>
              </tr>

            </tbody>
          </table>
        </div>
        <div class="clearfix" *ngIf="page.empty == false">
          <ul class="pagination float-right" *ngIf="page.totalElements > 1">
            <li class="page-item" *ngIf="page.first==false"><button class="btn page-link"
                (click)="updateDataTable(0,page.size)"><i class="nb-arrow-left"></i></button></li>
            <li class="page-item" *ngIf="page.first==false"><button class="btn page-link"
                (click)="updateDataTable(page.number-1,page.size)">{{page.number}}</button></li>
            <li class="page-item active"><a class="page-link"><strong>{{page.number+1}}</strong></a></li>
            <li class="page-item" *ngIf="page.last==false"><button class="btn page-link"
                (click)="updateDataTable(page.number+1,page.size)">{{page.number+2}}</button></li>
            <li class="page-item" *ngIf="page.last==false"><button class="btn page-link"
                (click)="updateDataTable(page.totalPages-1,page.size)"><i class="nb-arrow-right"></i></button></li>
          </ul>
        </div>
      </nb-card-body>
    </nb-card>
  </div>
</div>